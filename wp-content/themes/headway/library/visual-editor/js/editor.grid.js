/*
 * Headway Grid
 *
 * Copyright 2011-2013, Headway Themes, LLC
 *
 * http://headwaythemes.com
 */
(function(a,b){a.widget("ui.headwayGrid",a.ui.mouse,{options:{useIndependentGrid:false,columns:Headway.defaultGridColumnCount,columnWidth:Headway.defaultGridColumnWidth,gutterWidth:Headway.defaultGridGutterWidth,yGridInterval:10,minBlockHeight:10,selectedBlocksContainerClass:"selected-blocks-container",defaultBlockClass:"block",defaultBlockContentClass:"block-content"},_create:function(){this.wrapper=this.element;this.container=this.wrapper.find(".grid-container");this.iframe=a(Headway.iframe);this.contents=a(this.iframe).contents();this.document=a(this.iframe).contents();if(typeof $i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]!="undefined"){if(typeof $i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["use-independent-grid"]!="undefined"){this.options.useIndependentGrid=$i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["use-independent-grid"]}if(typeof $i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["columns"]!="undefined"){this.options.columns=$i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["columns"]}if(typeof $i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["column-width"]!="undefined"){this.options.columnWidth=$i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["column-width"]}if(typeof $i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["gutter-width"]!="undefined"){this.options.gutterWidth=$i("#whitewrap").data("wrappers")[this.wrapper.attr("id")]["gutter-width"]}}this.addColumnGuides();this.updateGridCSS();this.helperTemplate=a('<div class="ui-grid-helper block"></div>');this.offset=this.container.offset();this.wrapper.addClass("ui-headway-grid");this.wrapper.disableSelection();this._mouseInit();this._on(this.wrapper,{mousedown:"wrapperMouseDown"});this._on(this.contents,{mousedown:"iframeMouseDown",mouseup:"iframeMouseUp"});this._on(this.iframe,{mouseleave:"iframeMouseLeave"});this._on(this.contents,{mousemove:"iframeMouseMove"});this._on(a(window),{resize:"resetGridCalculations"});this._on(a(window),{resize:"alignAllBlocksWithGuides"});this.initResizable(this.container.children("."+this.options.defaultBlockClass.replace(".","")));this.initDraggable(this.container.children("."+this.options.defaultBlockClass.replace(".","")));this._initDroppable(this.container);this.updateGridContainerHeight();this.container.delegate("."+this.options.defaultBlockClass.replace(".",""),"dblclick",function(d){var c=a(this).parents(".ui-headway-grid").data("ui-headwayGrid");if(a(this).hasClass("grouped-block")&&c.container.find(".grouped-block").length===1){a(this).removeClass("grouped-block");c.container.removeClass("grouping-active");hideNotification("mass-block-selection")}else{if(a(this).hasClass("grouped-block")){a(this).removeClass("grouped-block")}else{a(this).addClass("grouped-block");c.container.addClass("grouping-active");showNotification({id:"mass-block-selection",message:"Message Block Selection Mode",closable:true,closeOnEscKey:true,closeTimer:false,opacity:0.8,closeCallback:function(){$i(".grouped-block").removeClass("grouped-block");c.container.removeClass("grouping-active")}})}}});this.alignAllBlocksWithGuides()},resetGridCalculations:function(){this.grid={columns:this.container.find(".grid-guide").length,columnWidth:parseInt(this.container.find(".grid-guide:eq(1)").outerWidth()),gutterWidth:parseInt(this.container.find(".grid-guide:eq(1)").css("marginLeft").replace("px",""))};var c=this;this.wrapper.find(".block:visible").each(function(){if(a(this).data("ui-draggable")){a(this).draggable("option","grid",[c.grid.columnWidth+c.grid.gutterWidth,c.options.yGridInterval])}if(a(this).data("ui-resizable")){a(this).resizable("option","grid",[c.grid.columnWidth+c.grid.gutterWidth,c.options.yGridInterval]);a(this).resizable("option","maxWidth",c.grid.columns*(c.grid.columnWidth+c.grid.gutterWidth))}})},_destroy:function(){this.element.resizable("destroy");this.element.find(".ui-droppable").droppable("destroy");this.element.removeClass("ui-grid ui-grid-disabled").removeData("grid").unbind(".grid");this._mouseDestroy();this.element.find(".ui-resizable").resizable("destroy");this.element.find(".ui-draggable").draggable("destroy");return this},disable:function(){this.element.resizable("disable");this.element.find(".ui-droppable").droppable("disable");this.element.find(".ui-resizable").resizable("disable");this.element.find(".ui-draggable").draggable("disable")},enable:function(){this.element.resizable("enable");this.element.find(".ui-droppable").droppable("enable");this.element.find(".ui-resizable").resizable("enable");this.element.find(".ui-draggable").draggable("enable")},iframeMouseDown:function(c){this._iframeMouseDownEvent=c;this._iframeMouseDownEventElement=a(c.originalEvent.target)},iframeMouseUp:function(c){delete this._iframeMouseDownEvent;delete this._iframeMouseDownEventElement},iframeMouseLeave:function(c){$iDocument().trigger("mouseup")},iframeMouseMove:function(c){if(typeof this._iframeMouseDownEvent!="undefined"||typeof this._doingHoverBlockToTop!="undefined"||!Headway.touch){return}this._doingHoverBlockToTop=true;setTimeout(a.proxy(function(){var f=[];var e=c.pageX;var d=c.pageY;a(this.container).find(".block").each(function(){var m=a(this);var l=m.offset();var h=l.left;var k=l.top;var g=h+m.width();var j=k+m.height();if(e<h||e>g){return}if(d<k||d>j){return}f.push(m)});f.sort(function(h,g){if(g.width()*g.height()>h.width()*h.height()){return 1}return 0});this.sendBlockToTop(a(f.pop()));delete this._doingHoverBlockToTop},this),50)},wrapperMouseDown:function(c){if(!c||this.container.hasClass("grouping-active")||getBlock(c.target)){return}$i(".blank-block").each(function(){removePanelTab("block-"+getBlockID(a(this)));a(this).remove()})},_mouseStart:function(d){this.mouseStartPosition=[d.pageX-this.container.offset().left,d.pageY-this.container.offset().top];var c=a(d.target);if(!d||d.ctrlKey||this.container.hasClass("grouping-active")||getBlock(d.target)||(c.hasClass("wrapper-handle")||c.parents(".wrapper-handle").length)||(c.hasClass("ui-resizable-handle")&&c.parent().hasClass("wrapper"))||this.wrapper.hasClass("wrapper-mirrored")){return true}this._trigger("start",d);this.helper=a(this.helperTemplate).clone().appendTo(this.container);this.helper.css({width:this.grid.columnWidth,height:0,top:0,left:0,display:"none"});if(this.wrapper.hasClass("wrapper-fluid")){this.wrapper.find(".wrapper-buttons").hide()}this.draggingOnWrapper=true;addBlockDimensionsTooltip(this.helper);return true},_mouseDrag:function(p){var g=a(p.target);if(!p||!this.helper||p.ctrlKey||this.container.hasClass("grouping-active")||(!this.helper&&getBlock(p.target))||(g.hasClass("wrapper-handle")||g.parents(".wrapper-handle").length)||(g.hasClass("ui-resizable-handle")&&g.parent().hasClass("wrapper"))||(!this.draggingOnWrapper||typeof this.draggingOnWrapper=="undefined")||this.wrapper.hasClass("wrapper-mirrored")){return}var j=a(this.container);var o=j.offset();var s=this.mouseStartPosition[0];var f=this.mouseStartPosition[1];var q=p.pageX-o.left;var e=p.pageY-o.top;if(s>q){var t=q;q=s;s=t}if(f>e){var t=e;e=f;f=t}var h=o.left;var l=o.top;var n=j.height();var k=j.width();if(q>=k&&s>=k){return}if(e>=n&&f>=n){return}if(s<0){s=0}if(f<0){f=0}if(e>n){e=n}var u=s.toNearest(this.grid.columnWidth+this.grid.gutterWidth);var m=f.toNearest(this.options.yGridInterval);var d=q.toNearest(this.grid.columnWidth+this.grid.gutterWidth)-u-this.grid.gutterWidth;var c=e.toNearest(this.options.yGridInterval)-f.toNearest(this.options.yGridInterval);Headway.blankBlockOptions={display:"block",left:u,top:m,width:d,height:c};if(u+d>(this.grid.columns*(this.grid.columnWidth+this.grid.gutterWidth))){Headway.blankBlockOptions.width=k-Headway.blankBlockOptions.left}if(p.pageY>(l+n)){Headway.blankBlockOptions.height=n-m}this.helper.css(Headway.blankBlockOptions);var v=Math.round((Headway.blankBlockOptions.width+this.grid.gutterWidth)/(this.grid.columnWidth+this.grid.gutterWidth));var r=Math.round(Headway.blankBlockOptions.left/(this.grid.columnWidth+this.grid.gutterWidth));if(v==0){v=1}if(v){setBlockGridWidth(this.helper,v)}if(r){setBlockGridLeft(this.helper,r)}this.alignBlockWithGuides(this.helper);if(Headway.blankBlockOptions.height<this.options.minBlockHeight){this.helper.addClass("block-error")}else{if(this.helper.hasClass("block-error")){this.helper.removeClass("block-error")}}if(!a.support.touch){this.helper.qtip("option","hide.delay",10000);this.helper.qtip("option","show.delay",10);this.helper.qtip("show");this.helper.qtip("option","content.text",blockDimensionsTooltipContent);this.helper.qtip("reposition")}this._trigger("drag",p);this.draggingOnWrapper=true;return false},_mouseStop:function(c){if(!c||c.ctrlKey||this.container.hasClass("grouping-active")||!this.helper||this.wrapper.hasClass("wrapper-mirrored")){return}this._trigger("stop",c);Headway.blankBlockOptions={width:getBlockGridWidth(this.helper),left:getBlockGridLeft(this.helper),pixelWidth:this.helper.width(),pixelLeft:this.helper.position().left,height:this.helper.height(),top:this.helper.position().top};if(this.helper.qtip("api")){this.helper.qtip("api").destroy(true)}this.wrapper.find(".wrapper-buttons").show();this.helper.remove();delete this.helper;if(Headway.blankBlockOptions.pixelWidth<this.grid.columnWidth||Headway.blankBlockOptions.height<this.options.minBlockHeight){return false}this.addBlankBlock(Headway.blankBlockOptions);this.mouseStartPosition=false;delete this.draggingOnWrapper;return false},initResizable:function(c){if(typeof c=="string"){var c=a(c)}c.resizable({handles:"n, e, s, w, ne, se, sw, nw",grid:[this.grid.columnWidth+this.grid.gutterWidth,this.options.yGridInterval],containment:this.container,minHeight:this.options.minBlockHeight,maxWidth:this.grid.columns*(this.grid.columnWidth+this.grid.gutterWidth),start:this.resizableStart,resize:this.resizableResize,stop:this.resizableStop})},resizableStart:function(e,f){var h=getBlock(f.element);var d=h.parents(".ui-headway-grid").data("ui-headwayGrid");var g=parseInt(h.css("minHeight").replace("px",""));var c=h.height();if(g<=c){h.css("minHeight",0)}h.addClass("block-hover");h.qtip("option","hide.delay",10000);h.qtip("show");h.qtip("reposition");if(d.wrapper.hasClass("wrapper-fluid")){d.wrapper.find(".wrapper-buttons").hide()}},resizableResize:function(d,e){var h=getBlock(e.element);var c=h.parents(".ui-headway-grid").data("ui-headwayGrid");var j=Math.round((h.width()+c.grid.gutterWidth)/(c.grid.columnWidth+c.grid.gutterWidth));var g=Math.round(h.position().left/(c.grid.columnWidth+c.grid.gutterWidth));setBlockGridWidth(h,j);setBlockGridLeft(h,g);c.alignBlockWithGuides(h);var f=h.data("qtip");$i("#qtip-"+f.id).remove();f.rendered=false;f.render();f.show()},resizableStop:function(d,j){var e=getBlock(j.element);var c=e.parents(".ui-headway-grid").data("ui-headwayGrid");var g=Math.ceil(e.width()/(c.grid.columnWidth+c.grid.gutterWidth));var f=Math.round(e.position().left/(c.grid.columnWidth+c.grid.gutterWidth));var k=getBlockDimensionsPixels(e).height;var l=getBlockGridWidth(e);var n=getBlockGridLeft(e);var m=j.originalSize.height;c.wrapper.find(".wrapper-buttons").show();var h=function(){e.css("width","");e.css("left","");c.alignBlockWithGuides(e);dataSetBlockDimensions(getBlockID(e),getBlockDimensions(e));dataSetBlockPosition(getBlockID(e),getBlockPosition(e));blockIntersectCheck(e)?allowSaving():disallowSaving();e.qtip("option","show.delay",300);e.qtip("option","hide.delay",25);e.qtip("show");e.qtip("reposition");e.removeClass("block-hover")};logHistory({description:"Resized block #"+getBlockID(e),action:function(){setBlockGridWidth(e,g);setBlockGridLeft(e,f);e.height(k);e.attr({"data-grid-top":getBlockPositionPixels(e).top,"data-height":k});h()},actionReverse:function(){setBlockGridWidth(e,l);setBlockGridLeft(e,n);e.height(m);e.attr({"data-grid-top":j.originalPosition.top,"data-height":m});h()}})},initDraggable:function(c){if(typeof c=="string"){c=a(c)}c.css("cursor","move").draggable({grid:[this.grid.columnWidth+this.grid.gutterWidth,this.options.yGridInterval],containment:this.container,scrollSpeed:40,start:this.draggableStart,stop:this.draggableStop,drag:this.draggableDrag})},draggableStart:function(d,e){if(d.ctrlKey){return false}var c=getBlock(a(this)).parents(".ui-headway-grid").data("ui-headwayGrid");blockGroupingOriginals={};blockGroupingOriginals[getBlockID(this)]={top:getBlockPositionPixels(this).top,left:getBlockPositionPixels(this).left};if(a(this).hasClass("grouped-block")){c.container.find(".grouped-block").each(function(f){if(d.srcElement==this){return}blockGroupingOriginals[getBlockID(this)]={top:parseInt(a(this).css("top").replace("px",""))||0,left:parseInt(a(this).css("left").replace("px",""))||0}});c.sendBlockToTop(c.container.find(".grouped-block"))}else{c.container.removeClass("grouping-active");c.container.find(".grouped-block").removeClass("grouped-block");hideNotification("mass-block-selection")}beginTop=a(this).offset().top;beginLeft=a(this).offset().left;if(c.wrapper.hasClass("wrapper-fluid")){c.wrapper.find(".wrapper-buttons").hide()}a(getBlock(e.helper)).qtip("hide")},draggableDrag:function(f,r){var q=a(this);var j=q.offset();var g=getBlock(a(this)).parents(".grid-container");var d=getBlock(a(this)).parents(".ui-headway-grid").data("ui-headwayGrid");a(getBlock(r.helper)).qtip("hide");if(q.hasClass("grouped-block")){var n=j.top-beginTop;var p=j.left-beginLeft;var o=[];d.container.find(".grouped-block").each(function(t){if(f.srcElement==this){return}o.push({block:a(this),top:blockGroupingOriginals[getBlockID(this)].top+n,left:blockGroupingOriginals[getBlockID(this)].left+p})});var s=true;var m=true;var h=0;var c=0;var e=0;a.each(o,function(u,t){if((blockGroupingOriginals[getBlockID(t.block)].top+n)<0){s=false;h=Math.abs(blockGroupingOriginals[getBlockID(t.block)].top+n)}if((blockGroupingOriginals[getBlockID(t.block)].left+p)<0){m=false;c=Math.abs(blockGroupingOriginals[getBlockID(t.block)].left+p)}if((t.block.width()+blockGroupingOriginals[getBlockID(t.block)].left+p)>d.container.width()){m=false;c=-(blockGroupingOriginals[getBlockID(t.block)].left+p)}});a.each(o,function(u,t){if(s){t.block.css("top",t.top)}if(m){var w=t.block;w.css("left",t.left);var v=String(Math.round(w.position().left/(d.grid.columnWidth+d.grid.gutterWidth)));setBlockGridLeft(w,v);d.alignBlockWithGuides(w)}});if(!s||!m){q.data("draggableOverflow",{top:h,left:c})}else{q.removeData("draggableOverflow")}}else{d.container.find(".grouped-block").removeClass("grouped-block");var l=q;var k=String(Math.round(l.position().left/(d.grid.columnWidth+d.grid.gutterWidth)));setBlockGridLeft(l,k);d.alignBlockWithGuides(l)}},draggableStop:function(f,g){var d=getBlock(a(this)).parents(".ui-headway-grid").data("ui-headwayGrid");if(d.container.find(".grouped-block").length){var j=d.container.find(".grouped-block")}else{var j=getBlock(g.helper)}d.wrapper.find(".wrapper-buttons").show();var c=[];if(j.length===1){var e="Moved block #"+getBlockID(block)}else{var e="Mass Moved Blocks: "}j.each(function(){var k=0;var l=0;if(typeof a(this).data("draggableOverflow")!="undefined"){var k=a(this).data("draggableOverflow").left;var l=a(this).data("draggableOverflow").top;a(this).removeData("draggableOverflow")}c.push({block:a(this),newGridLeft:Math.round((a(this).position().left+k)/(d.grid.columnWidth+d.grid.gutterWidth)),oldGridLeft:getBlockGridLeft(a(this)),newGridTop:(getBlockPositionPixels(a(this)).top+l).toNearest(10),oldGridTop:blockGroupingOriginals[getBlockID(this)].top.toNearest(10)});if(j.length>1){e+="#"+getBlockID(this)+", "}});if(j.length>1){e=e.substring(0,e.length-2)}var h=function(m,l){var q=m.block;var n=m.oldGridLeft;var p=m.oldGridTop;var k=m.newGridLeft;var o=m.newGridTop;if(l){n=m.newGridLeft;p=m.newGridTop;k=m.oldGridLeft;o=m.oldGridTop}setBlockGridLeft(q,k);q.css("top",o);q.attr({"data-grid-top":o});d.alignBlockWithGuides(q);dataSetBlockPosition(getBlockID(q),getBlockPosition(q));dataSetBlockWrapper(getBlockID(q),getBlockWrapper(q).attr("id"));if(blockIntersectCheck(q)){allowSaving()}else{disallowSaving()}};logHistory({description:e,action:function(){jQuery.each(c,function(l,k){h(k,false)})},actionReverse:function(){jQuery.each(c,function(l,k){h(k,true)})}});a(document).focus();a(this).data("hoverWaitTimeout",setTimeout(function(){a(getBlock(g.helper)).qtip("reposition");a(getBlock(g.helper)).qtip("show")},300))},_initDroppable:function(c){if(typeof c=="string"){c=a(c)}c.droppable({activeClass:"ui-state-highlight",hoverClass:"ui-state-hover",accept:function(d){if(!d.hasClass("block")){return false}if(d.parents(".grid-container").first().is(c)){return false}return true},tolerance:"pointer",over:function(d,e){},out:function(d,e){},drop:function(f,l){var j=l.draggable;var d=a(this);var g=d.parents(".wrapper").data("ui-headwayGrid");var h=j.parents(".grid-container");if(h.get(0)==d.get(0)){return}a(this).append(j);var m=f.offsetY-(getBlockDimensionsPixels(j).height/3);if(m<0){var m=0}j.css({top:m});var e=getBlockPosition(j);var k=getBlockDimensions(j);if(parseInt(e.left)+parseInt(k.width)>g.grid.columns){setBlockGridLeft(j,0)}if(parseInt(k.width)>g.grid.columns){setBlockGridWidth(j,g.grid.columns)}dataSetBlockPosition(getBlockID(j),getBlockPosition(j));j.draggable("destroy");j.resizable("destroy");d.parents(".wrapper").headwayGrid("initDraggable",j);d.parents(".wrapper").headwayGrid("initResizable",j);if(d.height()<(m+j.height())){d.height(m+j.height())}blockIntersectCheck(false,h);blockIntersectCheck(false,d);dataSetBlockWrapper(getBlockID(j),getBlockWrapper(j).attr("id"));j.parents(".ui-headway-grid").first().data("ui-headwayGrid").alignBlockWithGuides(j)}})},addBlankBlock:function(e,c){var g={top:0,left:0,width:140,height:this.options.minBlockHeight,id:null};var e=a.extend({},g,e);if(typeof f=="undefined"){var f=true}if(typeof c=="undefined"){var c=false}var d=(e.id==false||e.id==null)?getAvailableBlockID():e.id;if(typeof d==="undefined"||!d){return false}Headway.blankBlock=a('<div><div class="block-content-fade block-content"></div></div>').attr("data-id",d).data("id",d).attr("id","block-"+d).addClass(this.options.defaultBlockClass.replace(".",""));Headway.blankBlock.addClass("blank-block");var h=Headway.blankBlock;h.css({height:parseInt(e.height),top:parseInt(e.top),position:"absolute",visibility:"hidden",left:"",width:""});setBlockGridLeft(h,e.left);setBlockGridWidth(h,e.width);this.alignBlockWithGuides(h);h.attr({"data-height":parseInt(e.height),"data-grid-top":parseInt(e.top)});h.appendTo(this.container);h.css("visibility","visible");if(c==false){openBlockTypeSelector(a(Headway.blankBlock))}this.initResizable(h);this.initDraggable(h);blockIntersectCheck(h);return h},setupBlankBlock:function(d,c){if(typeof c=="undefined"){var c=false}Headway.blankBlock.removeClass("blank-block");Headway.blankBlock.addClass("block-type-"+d);loadBlockContent({blockElement:Headway.blankBlock,blockOrigin:{type:d,id:0,layout:Headway.currentLayout},blockSettings:{dimensions:getBlockDimensions(Headway.blankBlock),position:getBlockPosition(Headway.blankBlock)}});if(getBlockTypeObject(d)["fixed-height"]===true){Headway.blankBlock.addClass("block-fixed-height")}else{Headway.blankBlock.addClass("block-fluid-height")}if(!getBlockTypeObject(d)["show-content-in-grid"]){Headway.blankBlock.addClass("hide-content-in-grid")}dataAddBlock(getBlockID(Headway.blankBlock),getBlockType(Headway.blankBlock));dataSetBlockPosition(getBlockID(Headway.blankBlock),getBlockPosition(Headway.blankBlock));dataSetBlockDimensions(getBlockID(Headway.blankBlock),getBlockDimensions(Headway.blankBlock));dataSetBlockWrapper(getBlockID(Headway.blankBlock),Headway.blankBlock.parents(".wrapper").first().attr("id"));if(blockIntersectCheck(Headway.blankBlock)){allowSaving()}else{disallowSaving()}var e=Headway.blankBlock;delete Headway.blankBlock;delete Headway.blankBlockOptions;return e},addBlock:function(d){var e={top:0,left:0,width:1,height:this.options.minBlockHeight,type:null,id:null,settings:[]};var d=a.extend({},e,d);if(this.addBlankBlock(d,true)){var f=this.setupBlankBlock(d.type,true);var c=getBlockID(f);a.each(d.settings,function(g,h){dataSetBlockOption(c,g,h);if(g=="mirror-block"){updateBlockMirrorStatus(false,f,h,false)}});this.updateGridContainerHeight();return f}else{return false}},sendBlockToTop:function(c){if(typeof c=="string"){var c=getBlock(c)}if(!c||!c.length){return}$i(".block").css("zIndex",1);c.css("zIndex",2)},updateGridContainerHeight:function(){var c=this.container;var e=this.wrapper;c.css("height",this.wrapper.height());if(c.find(".block:visible").length){var d=0;c.find(".block:visible").each(function(){var f=a(this).outerHeight()+a(this).position().top;if(f>d){d=f}});c.height(d)}updateIframeHeight()},addColumnGuides:function(){var c=this.container;c.find(".grid-guides").remove();var d=a('<div class="grid-guides grid-guides-grey"></div><!-- #grid -->');for(i=1;i<=this.options.columns;i++){d.append('<div class="grid-guide grid-width-1 grid-guide-'+i+'"></div>')}d.prependTo(c)},alignBlockWithGuides:function(h){h.css({left:"",width:""});var k=this.container.children(".grid-guides:visible");if(!k.length){return}var g=parseInt(getBlockGridLeft(h));var e=parseInt(getBlockGridWidth(h));if(typeof g=="undefined"||isNaN(g)||g<0){g=0}if(typeof e=="undefined"||isNaN(e)||e==0){e=1}var d=((g+1)<this.grid.columns)?(g+1):this.grid.columns;var n=k.find(".grid-guide-"+d);var o=((g+e)<this.grid.columns)?(g+e):this.grid.columns;var c=k.find(".grid-guide-"+o);if(!c.length){c=n}if((g+1)<=(g+e)){var j=parseInt(n.css("marginLeft").replace("px",""));var m=parseInt(c.css("marginLeft").replace("px",""));var f=n.position().left+j;var l=(c.position().left+c.outerWidth())-(n.position().left)-1;if(g==0){l=l+m}h.css({left:Math.ceil(f)+"px",width:Math.ceil(l)+"px"})}},alignAllBlocksWithGuides:function(){var c=this;this.container.find(".block:visible").each(function(){c.alignBlockWithGuides(a(this))})},updateGridCSS:function(){var d=this.wrapper;var c=a("div#wrapper-"+getWrapperID(d)+"-tab");if(this.options.useIndependentGrid){updateGridCSS("div#"+d.attr("id"),this.options.columns,this.options.columnWidth,this.options.gutterWidth,c)}else{updateGridCSS("div#"+d.attr("id"),this.options.columns,Headway.globalGridColumnWidth,Headway.globalGridGutterWidth,c)}this.resetGridCalculations();this.alignAllBlocksWithGuides();return d}});a.extend(a.ui.headwayGrid,{version:"2.1"})})(jQuery);